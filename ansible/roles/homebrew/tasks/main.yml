- name: Check homebrew installed
  when:
    - ansible_facts['distribution'] == "MacOSX"
  shell: command -v brew
  ignore_errors: true
  register: brew_exists

- name: Upgrade all homebrew
  when:
    - ansible_facts['distribution'] == "MacOSX"
    - brew_exists
  community.general.homebrew:
    update_homebrew: true
    upgrade_all: true
    upgrade_options: ignore-pinned

- name: Tap Homebrew repositories
  when:
    - ansible_facts['distribution'] == "MacOSX"
    - ansible_architecture == "arm64"
    - brew_exists
  include_items: homebrew_taps.yml

- name: Install Homebrew formulae arm64
  when:
    - ansible_facts['distribution'] == "MacOSX"
    - ansible_architecture == "arm64"
    - brew_exists
